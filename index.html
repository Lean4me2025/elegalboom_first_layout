<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eLegalBoom — Document Request</title>
  <style>
    :root{
      --bg:#f7f8fa;
      --panel:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --border:#e5e7eb;
      --accent:#0d6efd;
      --accent-900:#00327a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height:1.5;
    }
    .container{
      max-width:980px;
      margin:28px auto 80px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow:0 4px 18px rgba(0,0,0,.04);
      padding:28px;
    }
    h1{
      font-size:36px;
      margin:0 0 6px;
      letter-spacing:.2px;
    }
    .sub{color:var(--muted); margin-bottom:22px}
    .config-hint{
      display:inline-block;
      background:#eef2ff;
      color:#3730a3;
      border:1px solid #c7d2fe;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      margin-bottom:14px;
    }
    .grid{
      display:grid;
      gap:14px;
      grid-template-columns: 1fr 1fr;
    }
    .grid-1{grid-template-columns: 1fr}
    label{font-weight:600; font-size:14px; margin-bottom:4px; display:block}
    input, select, textarea{
      width:100%;
      padding:12px 10px;
      border:1px solid var(--border);
      border-radius:8px;
      font-size:14px;
      background:#fff;
    }
    textarea{min-height:110px; resize:vertical}
    .section-title{font-size:18px; font-weight:700; margin:16px 0 2px}
    .hint{font-size:12px; color:var(--muted); margin-top:2px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    .row-3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px}
    .actions{
      margin-top:26px;
      display:flex; gap:12px; align-items:center;
      border-top:1px dashed var(--border);
      padding-top:18px;
    }
    button{
      background:var(--accent);
      color:#fff;
      font-weight:700;
      border:none;
      border-radius:999px;
      padding:12px 18px;
      cursor:pointer;
    }
    button:hover{background:var(--accent-900)}
    .disclaimer{
      margin-top:24px; color:var(--muted); font-size:12px; text-align:center
    }
    .radio-wrap{display:flex; gap:20px; margin-top:8px; flex-wrap:wrap}
    .radio-wrap label{font-weight:500}
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      background:#f3f4f6; border:1px solid var(--border); padding:0 6px; border-radius:6px; font-size:12px
    }
    .ok{color:#065f46}
    .err{color:#991b1b}
  </style>
</head>
<body>
  <main class="container">
    <h1>Request Your Document</h1>
    <div class="sub">Fast, accurate, affordable. Human‑reviewed. Delivered to your inbox.</div>
    <div id="configHint" class="config-hint" style="display:none">
      Config needed: set your <span class="kbd">SUPABASE_URL</span> and <span class="kbd">SUPABASE_ANON_KEY</span> at the bottom of this file.
    </div>

    <form id="intakeForm" autocomplete="on">
      <div class="section-title">Contact</div>
      <div class="row">
        <div>
          <label for="first_name">First Name</label>
          <input id="first_name" name="first_name" required />
        </div>
        <div>
          <label for="last_name">Last Name</label>
          <input id="last_name" name="last_name" required />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required />
        </div>
        <div>
          <label for="phone">Phone (optional)</label>
          <input id="phone" name="phone" />
        </div>
      </div>

      <div class="section-title">Business / Address</div>
      <div class="grid grid-1">
        <div>
          <label for="business_name">Business / Entity Name (optional)</label>
          <input id="business_name" name="business_name" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="address">Street</label>
          <input id="address" name="address" />
        </div>
        <div>
          <label for="city">City</label>
          <input id="city" name="city" />
        </div>
      </div>
      <div class="row-3">
        <div>
          <label for="state">State</label>
          <select id="state" name="state">
            <option value="">Select...</option>
            <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option>
            <option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="DC">District of Columbia</option>
            <option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option>
            <option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option>
            <option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option>
            <option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option>
            <option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option>
            <option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option>
            <option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option>
          </select>
        </div>
        <div>
          <label for="governing_state">Governing State (if different)</label>
          <input id="governing_state" name="governing_state" placeholder="Defaults to Address State" />
        </div>
        <div>
          <label for="zip">ZIP</label>
          <input id="zip" name="zip" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="preferred_deadline">Preferred Deadline</label>
          <input id="preferred_deadline" name="preferred_deadline" type="date" />
        </div>
        <div></div>
      </div>

      <div class="section-title">What do you need?</div>
      <div class="row">
        <div>
          <label for="doc_type">Document Type</label>
          <select id="doc_type" name="doc_type" required>
            <option value="">Select one…</option>
            <option value="LLC">LLC Formation</option>
            <option value="Partnership">Partnership Agreement</option>
            <option value="NDA">Non‑Disclosure Agreement</option>
            <option value="OperatingAgreement">LLC Operating Agreement</option>
            <option value="Employment">Employment Agreement</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div>
          <label for="urgency">Urgency</label>
          <select id="urgency" name="urgency">
            <option value="Normal (2–3 days)">Normal (2–3 days)</option>
            <option value="Rush (24 hours)">Rush (24 hours)</option>
          </select>
        </div>
      </div>

      <div class="section-title">Details (key facts, special terms)</div>
      <div class="grid grid-1">
        <div>
          <textarea id="details" name="details" placeholder="Anything we should know to draft accurately…"></textarea>
        </div>
      </div>

      <div class="section-title">Parties (add up to 4)</div>
      <div class="row">
        <div>
          <label for="party1_name">Party 1 Name</label>
          <input id="party1_name" name="party1_name" />
        </div>
        <div>
          <label for="party1_role">Role</label>
          <input id="party1_role" name="party1_role" placeholder="Member, Partner, Disclosing…" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="party1_email">Email (optional)</label>
          <input id="party1_email" name="party1_email" type="email" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="party2_name">Party 2 Name</label>
          <input id="party2_name" name="party2_name" />
        </div>
        <div>
          <label for="party2_role">Role</label>
          <input id="party2_role" name="party2_role" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="party2_email">Email (optional)</label>
          <input id="party2_email" name="party2_email" type="email" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="party3_name">Party 3 Name</label>
          <input id="party3_name" name="party3_name" />
        </div>
        <div>
          <label for="party3_role">Role</label>
          <input id="party3_role" name="party3_role" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="party3_email">Email (optional)</label>
          <input id="party3_email" name="party3_email" type="email" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="party4_name">Party 4 Name</label>
          <input id="party4_name" name="party4_name" />
        </div>
        <div>
          <label for="party4_role">Role</label>
          <input id="party4_role" name="party4_role" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="party4_email">Email (optional)</label>
          <input id="party4_email" name="party4_email" type="email" />
        </div>
      </div>

      <div class="section-title">How do you want to file?</div>
      <div class="radio-wrap">
        <label><input type="radio" name="file_option" value="self" checked /> I will download, sign, and file myself. <span class="hint">(No service charge)</span></label>
        <label><input type="radio" name="file_option" value="efile" /> Please have eLegalBoom file for me. <span class="hint">(Service fee TBD)</span></label>
      </div>

      <div class="actions">
        <button type="submit">Submit Request</button>
        <span id="status" class="hint"></span>
      </div>

      <div class="disclaimer">
        I understand eLegalBoom provides AI‑assisted document preparation with human QC and is not a law firm, nor does it provide legal advice.
      </div>
    </form>
  </main>

  <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // === CONFIG –– SET THESE TWO VALUES ===
    // Example URL looks like: https://xxxxxxxxxxxx.supabase.co
    const SUPABASE_URL = "REPLACE_WITH_YOUR_SUPABASE_URL";
    // The anon public key from Settings → API → Legacy API Keys → anon public
    const SUPABASE_ANON_KEY = "REPLACE_WITH_YOUR_ANON_KEY";
    // ======================================

    const statusEl = document.getElementById('status');
    const hint = document.getElementById('configHint');
    if (SUPABASE_URL.startsWith("REPLACE") || SUPABASE_ANON_KEY.startsWith("REPLACE")){
      hint.style.display = 'inline-block';
    }

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // small helper: generate human-readable order id (client-side)
    function makeOrderId(){
      const d = new Date();
      const y = d.getFullYear();
      const n = Math.floor(100000 + Math.random()*900000); // 6 digits
      return `ELB-${y}-${n}`;
    }

    document.getElementById('intakeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = 'Submitting…';

      const fd = new FormData(e.target);
      const data = Object.fromEntries(fd.entries());
      data.order_id = makeOrderId();

      // If governing_state is empty, default to state
      if(!data.governing_state) data.governing_state = data.state || '';

      try {
        const { error } = await supabase
          .from('requests')
          .insert([data]); // single row

        if (error){
          statusEl.innerHTML = '<span class="err">Error: ' + (error.message || error) + '</span>';
        } else {
          statusEl.innerHTML = '<span class="ok">Saved! Order ID ' + data.order_id + '.</span>';
          e.target.reset();
        }
      } catch (err){
        statusEl.innerHTML = '<span class="err">Error: ' + err.message + '</span>';
      }
    });
  </script>
</body>
</html>
